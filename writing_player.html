<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Writing a Player &mdash; Pelita v0.2.0-300-gd0882de documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'v0.2.0-300-gd0882de',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Pelita v0.2.0-300-gd0882de documentation" href="index.html" />
    <link rel="next" title="Running Players" href="running_player.html" />
    <link rel="prev" title="Project Information" href="info.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="writing-a-player">
<span id="id1"></span><h1>Writing a Player<a class="headerlink" href="#writing-a-player" title="Permalink to this headline">¶</a></h1>
<p>This section explains how to write a player.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>To begin with, we must define a few classes and some terminology which will be
used throughout this documentation.</p>
<dl class="docutils">
<dt><cite>pelita.datamodel.CTFUniverse</cite>:</dt>
<dd>The game’s universe. Holds a list of <code class="docutils literal"><span class="pre">Bot</span></code> instances, a list of <code class="docutils literal"><span class="pre">Team</span></code>
instances, a single <code class="docutils literal"><span class="pre">Maze</span></code> object and a list with the positions of food.
Can be queried to obtain information about the game.</dd>
<dt><cite>pelita.datamodel.Bot</cite>:</dt>
<dd>The data structure used to store the bot. This holds the position of the
<code class="docutils literal"><span class="pre">Bot</span></code> inside the Maze, its initial position, which team it belongs to
etc..</dd>
<dt><cite>pelita.datamodel.Team</cite>:</dt>
<dd>In capture-the-flag each <code class="docutils literal"><span class="pre">Bot</span></code> belongs to a <code class="docutils literal"><span class="pre">Team</span></code>. The team stores the
homezone of a team and its score.</dd>
<dt><cite>pelita.datamodel.Maze</cite>:</dt>
<dd>Data structure that stores the maze or layout, i.e. where walls are.</dd>
<dt><cite>pelita.game_master.GameMaster</cite>:</dt>
<dd>Controller object that asks players for moves and updates the <code class="docutils literal"><span class="pre">Universe</span></code>.
You will never need to interact with this object but it&#8217;s good to know that
this is the central object that coordinates the game.</dd>
</dl>
<p>In addition to these classes there are two additional relevant concepts:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">Player</span></code>:</th><td class="field-body">Your implementation of the <em>intelligence</em> for a <code class="docutils literal"><span class="pre">Bot</span></code>. The abstraction is
that a <em>player</em> object controls a <em>bot</em> object.</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">move</span></code>:</th><td class="field-body">A tuple that indicates where a <code class="docutils literal"><span class="pre">Bot</span></code> should move.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="player-basics">
<h2>Player Basics<a class="headerlink" href="#player-basics" title="Permalink to this headline">¶</a></h2>
<p>In order to write a player you should subclass from
<cite>pelita.player.AbstractPlayer</cite>. This is an abstract class which provides
several convenience methods and properties to interrogate the universe
including the bot instance that this player controls, but lacks the functions
to actually control the bot.</p>
<p>To subclass from <code class="docutils literal"><span class="pre">AbstractPlayer</span></code> import this with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pelita.player</span> <span class="kn">import</span> <span class="n">AbstractPlayer</span>
</pre></div>
</div>
<p>In order to make your player do something useful you must implement at least the
method <code class="docutils literal"><span class="pre">get_move()</span></code> to return a move. This can be one of:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">north</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">west</span><span class="p">,</span> <span class="n">east</span><span class="p">,</span> <span class="n">stop</span><span class="p">]</span>
</pre></div>
</div>
<p>The moves are provided by the <cite>pelita.datamodel</cite>, import them with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pelita.datamodel</span> <span class="kn">import</span> <span class="n">north</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">west</span><span class="p">,</span> <span class="n">east</span><span class="p">,</span> <span class="n">stop</span>
</pre></div>
</div>
<p>An example of such a player is the trivial <cite>pelita.player.StoppingPlayer</cite>
which simply returns <code class="docutils literal"><span class="pre">stop</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StoppingPlayer</span><span class="p">(</span><span class="n">AbstractPlayer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A Player that just stands still. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">get_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">datamodel</span><span class="o">.</span><span class="n">stop</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Besides the definition of your player, this file must contain a factory
function that returns a team (remember that the default game is a
fight between two teams of two bots each):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">factory</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">SimpleTeam</span><span class="p">(</span><span class="s">&quot;MyTeam&quot;</span><span class="p">,</span> <span class="n">StoppingPlayer</span><span class="p">(),</span> <span class="n">StoppingPlayer</span><span class="p">())</span>
</pre></div>
</div>
<p class="last">For more information about this, see also:<a class="reference internal" href="running_player.html"><em>Running Players</em></a></p>
</div>
<p>Note: the current state or the <code class="docutils literal"><span class="pre">CTFUniverse</span></code> is always implicitly available
via the <code class="docutils literal"><span class="pre">current_uni</span></code> property inherited from <code class="docutils literal"><span class="pre">AbstractPlayer</span></code>. But more
about that later.</p>
</div>
<div class="section" id="doing-more">
<h2>Doing More<a class="headerlink" href="#doing-more" title="Permalink to this headline">¶</a></h2>
<p>A slightly more useful example is the <cite>pelita.player.RandomPlayer</cite> which always
selects a move at random from the possible moves:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RandomPlayer</span><span class="p">(</span><span class="n">AbstractPlayer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A player that makes moves at random. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legal_moves</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>In the above example, we use an internal random number generator,
<cite>self.rnd</cite> instead of the one from the <cite>random</cite> module.</p>
<p class="last"><cite>self.rnd</cite> is seeded by the <cite>GameMaster</cite> during startup. This means
that whenever we initialise <cite>GameMaster</cite> with the same seed, we will get
the same numbers in our Player. This is very useful for testing,
especially when playing against other Players which use randomness,
because we can replay previous test games with improved algorithms.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To make the above example (and many of the following examples) work, it
might be necessary to add appropriate imports to your python source file,
for example:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pelita.player</span> <span class="kn">import</span> <span class="n">AbstractPlayer</span>
<span class="kn">from</span> <span class="nn">pelita.datamodel</span> <span class="kn">import</span> <span class="n">north</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">west</span><span class="p">,</span> <span class="n">east</span><span class="p">,</span> <span class="n">stop</span>
</pre></div>
</div>
</div>
<p>Here we can see the first convenience property <code class="docutils literal"><span class="pre">legal_moves</span></code> which returns a
dictionary mapping move tuples to position tuples. The random player simply
selects a move at random from the keys (moves) of this dictionary and then
moves there. <code class="docutils literal"><span class="pre">legal_moves</span></code> always includes stop.</p>
<p>The next example is the not-quite random player
<code class="docutils literal"><span class="pre">pelita.player.NQRandomPlayer</span></code>.  This one does not move back to the position
where it was on its last turn and never stops in place:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NQRandomPlayer</span><span class="p">(</span><span class="n">AbstractPlayer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Not-Quite-RandomPlayer that will move randomly but not stop or reverse. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">legal_moves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legal_moves</span>
        <span class="c"># Remove stop</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">legal_moves</span><span class="p">[</span><span class="n">datamodel</span><span class="o">.</span><span class="n">stop</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c"># now remove the move that would lead to the previous_position</span>
        <span class="c"># unless there is no where else to go.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">legal_moves</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">legal_moves</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_pos</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">del</span> <span class="n">legal_moves</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="c"># just in case, there is really no way to go to:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">legal_moves</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">datamodel</span><span class="o">.</span><span class="n">stop</span>
        <span class="c"># and select a move at random</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">legal_moves</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</pre></div>
</div>
<p>Here we can see the use of another convenience method: <code class="docutils literal"><span class="pre">previous_pos</span></code> which
gives the position the bot had in the previous round.</p>
<p>Additional information about the bot and game state can also be retrieved
with the <code class="docutils literal"><span class="pre">current_state</span></code> dictionary.</p>
</div>
<div class="section" id="the-maze-coordinate-system">
<h2>The Maze Coordinate System<a class="headerlink" href="#the-maze-coordinate-system" title="Permalink to this headline">¶</a></h2>
<p>The coordinate system is the standard coordinate system used in computer games.
<code class="docutils literal"><span class="pre">x</span></code> increases to the right, and <code class="docutils literal"><span class="pre">y</span></code> increases downwards, and a position is
encoded as the tuple <code class="docutils literal"><span class="pre">(x,</span> <span class="pre">y)</span></code>. There are no negative coordinates. The
following example illustrates this for a few positions:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>(0, 0)</td>
<td>(1, 0)</td>
<td>(2, 0)</td>
<td>(3, 0)</td>
<td>...</td>
</tr>
<tr class="row-even"><td>(0, 1)</td>
<td>(1, 1)</td>
<td>(2, 1)</td>
<td>(3, 1)</td>
<td>...</td>
</tr>
<tr class="row-odd"><td>(0, 2)</td>
<td>(1, 2)</td>
<td>(2, 2)</td>
<td>(3, 2)</td>
<td>...</td>
</tr>
<tr class="row-even"><td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>As a result we obtain the following direction vectors:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">north</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">south</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">west</span>  <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">east</span>  <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">stop</span>  <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="distances-in-the-maze">
<h3>Distances in the Maze<a class="headerlink" href="#distances-in-the-maze" title="Permalink to this headline">¶</a></h3>
<p>There are different ways of measuring distances between objects in the maze.
The <a class="reference external" href="http://en.wikipedia.org/wiki/Euclidean_distance">Euclidean distance</a>
is the length of the vector connecting the centers
of the cells where the objects are located:</p>
<div class="figure" id="id2">
<a class="reference internal image-reference" href="_images/distance_euclidean.png"><img alt="Euclidean distance." src="_images/distance_euclidean.png" style="width: 300px;" /></a>
<p class="caption"><span class="caption-text"><strong>Euclidean distance:</strong> The Euclidean distance between the two bots is
<span class="math">\(\sqrt{(x_1-x_2)^2 + (y_1-y_2)^2} = \sqrt{(4.5-2.5)^2+(0.5-1.5)^2} = \sqrt 5 \approx 2.236...\)</span></span></p>
</div>
<p>The <a class="reference external" href="http://en.wikipedia.org/wiki/Taxicab_geometry">Manhattan distance</a>,
also known as L1-distance or taxicab-distance, is the
absolute difference of the coordinates of the two objects:</p>
<div class="figure" id="id3">
<a class="reference internal image-reference" href="_images/distance_manhattan.png"><img alt="Manhattan distance." src="_images/distance_manhattan.png" style="width: 300px;" /></a>
<p class="caption"><span class="caption-text"><strong>Manhattan distance:</strong> The Manhattan distance between the two bots is
<span class="math">\(\left|x_1-x_2\right| + \left|y_1-y_2\right| = \left|4-2\right| + \left|0-1\right| = 3\)</span></span></p>
</div>
<p>The maze distance counts the number of cells of the shortest path that
connects the two objects:</p>
<div class="figure" id="id4">
<a class="reference internal image-reference" href="_images/distance_maze.png"><img alt="Maze distance." src="_images/distance_maze.png" style="width: 300px;" /></a>
<p class="caption"><span class="caption-text"><strong>Maze distance:</strong> The Maze distance between the two bots is <span class="math">\(5\)</span>.</span></p>
</div>
<p>Note that Manhattan and maze distances are always integer values.
In the game, distances are almost always measured either in Manhattan or in
maze distance.
We provide a series of convenience methods for dealing with position
and distances in <cite>pelita.graph</cite>:</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="pelita/pelita.graph.html#pelita.graph.new_pos" title="pelita.graph.new_pos"><code class="xref py py-obj docutils literal"><span class="pre">new_pos</span></code></a></td>
<td>Adds a position tuple and a move tuple.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="pelita/pelita.graph.html#pelita.graph.diff_pos" title="pelita.graph.diff_pos"><code class="xref py py-obj docutils literal"><span class="pre">diff_pos</span></code></a></td>
<td>Return the move required to move from one position to another.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="pelita/pelita.graph.html#pelita.graph.manhattan_dist" title="pelita.graph.manhattan_dist"><code class="xref py py-obj docutils literal"><span class="pre">manhattan_dist</span></code></a></td>
<td>Manhattan distance between two points.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="recovery-strategies-in-case-of-death-or-timeout">
<h3>Recovery Strategies in Case of Death or Timeout<a class="headerlink" href="#recovery-strategies-in-case-of-death-or-timeout" title="Permalink to this headline">¶</a></h3>
<p>Lastly, we are going to see some error recovery code in the
<code class="docutils literal"><span class="pre">get_move()</span></code> method.</p>
<p>As it happens, an offensive player can get killed every now and then. In
order to detect this, it&#8217;s best to compare the current position with its
initial position using the <code class="docutils literal"><span class="pre">initial_pos</span></code> convenience property, since this is
where it will respawn. Alternatively, it is also possible to keep track of the
timeouts using <code class="docutils literal"><span class="pre">self.current_state[&quot;timeout_teams&quot;]</span></code>, which holds the
number of timeouts each team has already used up.</p>
<p>Your player only has a limited time to return from <code class="docutils literal"><span class="pre">get_move()</span></code>. The default
is approximately three seconds. If your player does not respond in time, the
<code class="docutils literal"><span class="pre">GameMaster</span></code> will move the bot at random for this turn. It&#8217;s important to
recover from such an event.</p>
<p>The main problem with detecting a timeout is that, as long as your
computationally expensive process is running, there is no way to interrupt it.
Imagine an infinite <code class="docutils literal"><span class="pre">for</span></code> loop in your <code class="docutils literal"><span class="pre">get_move()</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>In this case, your <code class="docutils literal"><span class="pre">get_move()</span></code> will be executed exactly once! Thus it is
important to ensure that your search algorithms are efficient and fast.</p>
<p>For convenience <code class="docutils literal"><span class="pre">AbstractPlayer</span></code> has a <code class="docutils literal"><span class="pre">time_spent()</span></code> method, which
shows the approximate time since <code class="docutils literal"><span class="pre">get_move()</span></code> has been called. A simple
approach using this method could be as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_move</span><span class="p">():</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">best_move</span> <span class="o">=</span> <span class="n">stop</span>
    <span class="n">MAX_TIME</span> <span class="o">=</span> <span class="mi">3</span> <span class="c"># whatever the rules tell you</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_spent</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">MAX_TIME</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_move</span>
    <span class="c"># do some iterative data mining and eventually</span>
    <span class="c"># change the value of self.best_move</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">do_first_calculation</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_spent</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">MAX_TIME</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_move</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">do_second_calculation</span><span class="p">()</span>
    <span class="c"># ...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even though <code class="docutils literal"><span class="pre">time_spent()</span></code> takes into account the initial calculations
done in <code class="docutils literal"><span class="pre">AbstractPlayer</span></code>, it knows nothing about network delays.
Therefore, it seems adviseable not to wait until the last millisecond
before returning.</p>
</div>
<p>A very important thing to emphasise is the following: When one bot blocks,
the whole team blocks. This means that all subsequent calls to <code class="docutils literal"><span class="pre">get_move()</span></code>
for a team are stalled until the blocking <code class="docutils literal"><span class="pre">get_move()</span></code> has finished.</p>
<p>This also means, that it may happen that the second call to <code class="docutils literal"><span class="pre">get_move()</span></code>
is already behind in terms of time when it is being executed. In extreme
cases, it may even generate a second timeout <em>before</em> its execution.</p>
<p>There is no good way to predict this other than keeping track of one’s
own execution time and returning early, if necessary. For long lasting
tasks, it may be a good idea to experiment with concurrency.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>A remark on timeout handling during the <code class="docutils literal"><span class="pre">set_initial()</span></code> phase.</p>
<p class="last">Sometimes, it may seem a good idea to do some pre-calculations during the
<code class="docutils literal"><span class="pre">set_initial</span></code> phase. We like to enforce this by also giving each Player
some extra time. There is no strict limit, but after three seconds, the
<code class="docutils literal"><span class="pre">GameMaster</span></code> is going to move on with its duty. Just make sure you’ll be
ready when you receive the first <code class="docutils literal"><span class="pre">get_move()</span></code> call.</p>
</div>
</div>
</div>
<div class="section" id="interacting-with-the-maze">
<h2>Interacting with the Maze<a class="headerlink" href="#interacting-with-the-maze" title="Permalink to this headline">¶</a></h2>
<p>For a simple test whether a certain position on the maze is free or not,
we can check the <code class="docutils literal"><span class="pre">pelita.datamodel.Maze</span></code> class which has an instance in
our universe.:</p>
<div class="highlight-python"><div class="highlight"><pre>pos = (3, 3)
if maze[pos]:
    # has a wall
else:
    # is free
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Please compare the above syntax with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">if</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">maze</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p class="last">This checks whether a coordinate is valid.</p>
</div>
<p>Players may use an adjacency list representation provided by
<code class="docutils literal"><span class="pre">pelita.graph.AdjacencyList</span></code>. Let&#8217;s have a quick look at how this is
generated, in case you would like to implement your own <a class="reference external" href="http://en.wikipedia.org/wiki/Graph_(data_structure)">graph storage</a> or leverage an
alternative existing package such as <a class="reference external" href="http://networkx.lanl.gov/">NetworkX</a>.</p>
<p>In order to obtain the positions of all free spaces, the
<code class="docutils literal"><span class="pre">pelita.datamodel.CTFUniverse</span></code> class provides the method
<code class="docutils literal"><span class="pre">pelita.datamodel.CTFUniverse.free_positions()</span></code>.</p>
<p>There are a few additional constructs that are
useful when dealing with the maze. The property <code class="docutils literal"><span class="pre">positions</span></code> gives all the
positions in the maze.</p>
</div>
<div class="section" id="noisy-enemy-positions">
<h2>Noisy Enemy Positions<a class="headerlink" href="#noisy-enemy-positions" title="Permalink to this headline">¶</a></h2>
<p>In general, the <code class="docutils literal"><span class="pre">CTFUniverse</span></code> you receive is noisy. This means that you can
only obtain an accurate fix on the enemy bots if they are within 5 squares maze
distance (otherwise, the position is noisy with a uniform radius of 5 squares
maze distance). These two values may lead to confusing values: for example if
the bot is 6 squares away, but the added noise of 4 squares towards your bot,
make it appear as if it were only 2 squares away. Thus, you can check if a bot
position is noisy using the <code class="docutils literal"><span class="pre">noisy</span></code> attribute of the bot instance, in
combination with the <code class="docutils literal"><span class="pre">enemy_bots</span></code> convenience property provided by
<code class="docutils literal"><span class="pre">AbstractPlayer</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">enemy_bots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">noisy</span>
</pre></div>
</div>
<p>One idea is to implement probabilistic tracking using a <a class="reference external" href="http://en.wikipedia.org/wiki/Kalman_filter">Kalman filter</a></p>
<p>If you wish to know how the noise is implemented, look at the class:
<code class="docutils literal"><span class="pre">pelita.game_master.UniverseNoiser</span></code>.</p>
</div>
<div class="section" id="implementation-details-of-convenience-properties">
<h2>Implementation Details of Convenience Properties<a class="headerlink" href="#implementation-details-of-convenience-properties" title="Permalink to this headline">¶</a></h2>
<p>This section contains some details about the implementation of the convenience
properties of <code class="docutils literal"><span class="pre">AbstractPlayer</span></code>. Reading this section is not required, but may
be of interest to the curious reader.</p>
<p>Let&#8217;s take a quick look as the implementation
of <code class="docutils literal"><span class="pre">current_uni</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">current_uni</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The current Universe.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        universe : Universe</span>
<span class="sd">            the current Universe</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe_states</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Importantly we see that the <code class="docutils literal"><span class="pre">AbstractPlayer</span></code> automatically maintains a stack
of previous states of the Universe called <code class="docutils literal"><span class="pre">universe_states</span></code>.
As we can see <code class="docutils literal"><span class="pre">current_uni</span></code> is simply the top element of this stack. This
allows us to access the properties and methods of the <code class="docutils literal"><span class="pre">CTFUniverse</span></code>, for
example look at the implementation of <code class="docutils literal"><span class="pre">legal_moves</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">legal_moves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The currently possible moves, and where they lead.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        legal_moves : dict mapping moves to positions</span>
<span class="sd">            the currently legal moves</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_uni</span><span class="o">.</span><span class="n">legal_moves</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_pos</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we can see that this simply calls the method <code class="docutils literal"><span class="pre">legal_moves(pos)</span></code>
which is provided by <code class="docutils literal"><span class="pre">CTFUniverse</span></code>. We also see one of the convenience
properties used in the <code class="docutils literal"><span class="pre">bfs_food()</span></code> method: <code class="docutils literal"><span class="pre">current_pos</span></code> which returns the
current position of the bot.  Let&#8217;s have a look at this:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">current_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The current position of this bot.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        current_pos : tuple of (int, int)</span>
<span class="sd">            the current position (x, y) of this bot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">me</span><span class="o">.</span><span class="n">current_pos</span>
</pre></div>
</div>
<p>We see that this makes use of the <code class="docutils literal"><span class="pre">me</span></code> property which is defined as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">me</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The Bot object this Player controls.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        me : Bot</span>
<span class="sd">            the bot controlled by this player</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_uni</span><span class="o">.</span><span class="n">bots</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
</pre></div>
</div>
<p>As you can see, <code class="docutils literal"><span class="pre">me</span></code> will simply obtain the <code class="docutils literal"><span class="pre">Bot</span></code> instance controlled by
this player from the current universe using the hidden <code class="docutils literal"><span class="pre">_index</span></code> attribute of
the player. In practice, you should be able to avoid having to use the
<code class="docutils literal"><span class="pre">_index</span></code> directly but it&#8217;s good to know how this is implemented in case you
wish to do something exotic.</p>
<p>Lets now have a look at the convenience property <code class="docutils literal"><span class="pre">enemy_food</span></code> Again, this is
simply forwarded to the <code class="docutils literal"><span class="pre">CTFUniverse</span></code> using <code class="docutils literal"><span class="pre">current_uni</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">enemy_food</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Food owned by the enemy which can be eaten by this Player&#39;s bot.</span>

<span class="sd">        Please note that it is valid for this list to be empty during get_move.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        enemy_food : list of position tuples (int, int)</span>
<span class="sd">            The positions (x, y) of edible food</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_uni</span><span class="o">.</span><span class="n">enemy_food</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">me</span><span class="o">.</span><span class="n">team_index</span><span class="p">)</span>
</pre></div>
</div>
<p>As with <code class="docutils literal"><span class="pre">legal_moves</span></code>, a method from <code class="docutils literal"><span class="pre">CTFUniverse</span></code> is called, namely
<code class="docutils literal"><span class="pre">enemy_food</span></code>. However, we need to tell it which team we are on. This is
obtained using the <code class="docutils literal"><span class="pre">me</span></code> property to access the controlled <code class="docutils literal"><span class="pre">Bot</span></code> instance,
which in turn stores the <code class="docutils literal"><span class="pre">team_index</span></code>. In practice, the information stored in
the <code class="docutils literal"><span class="pre">CTFUniverse</span></code> should be accessible through the convenience properties of
the <code class="docutils literal"><span class="pre">AbstractPlayer</span></code>. However, if these do not suffice, please have a look
at the source code.</p>
<p>Now that you know about <code class="docutils literal"><span class="pre">universe_states</span></code>, <code class="docutils literal"><span class="pre">_index</span></code> and <code class="docutils literal"><span class="pre">current_pos</span></code>
let&#8217;s have a look at how the <code class="docutils literal"><span class="pre">previous_pos</span></code> property (used in the
<code class="docutils literal"><span class="pre">NQRandomPlayer</span></code>) is implemented:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">previous_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The previous position of the bot.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        previous_pos : tuple of (int, int)</span>
<span class="sd">            the previous position (x, y) of this bot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe_states</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">bots</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span><span class="o">.</span><span class="n">current_pos</span>
</pre></div>
</div>
<p>Again, we will make use of <code class="docutils literal"><span class="pre">universe_states</span></code>, but this time we will look at
the second element from the top of the stack. The <code class="docutils literal"><span class="pre">CTFUniverse</span></code> maintains a
list of bots <code class="docutils literal"><span class="pre">bots</span></code> and the hidden attribute <code class="docutils literal"><span class="pre">_index</span></code> can be used to obtain
the respective bot instance controlled by the player. Lastly, we simply look at
the <code class="docutils literal"><span class="pre">current_pos</span></code> property of the bot (the bot instance from one turn ago) to
obtain its previous position.</p>
<p>The <code class="docutils literal"><span class="pre">team</span></code> property uses the <code class="docutils literal"><span class="pre">me</span></code> property to access the bots
<code class="docutils literal"><span class="pre">team_index</span></code> which it then uses in <code class="docutils literal"><span class="pre">current_uni.teams</span></code> to get the
respective <code class="docutils literal"><span class="pre">Team</span></code> instance:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">team</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The Team object this Player&#39;s Bot is on.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        team : Team</span>
<span class="sd">            the team of the bot controlled by this player</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_uni</span><span class="o">.</span><span class="n">teams</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">me</span><span class="o">.</span><span class="n">team_index</span><span class="p">]</span>
</pre></div>
</div>
<p>Something similar is achieved for the <code class="docutils literal"><span class="pre">team_border</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">team_border</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Positions of the border positions.</span>
<span class="sd">        These are the last positions in the zone of the team.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        team_border : list of tuple of (int, int)</span>
<span class="sd">            the border positions</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_uni</span><span class="o">.</span><span class="n">team_border</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">me</span><span class="o">.</span><span class="n">team_index</span><span class="p">)</span>
</pre></div>
</div>
<p>And again for <code class="docutils literal"><span class="pre">enemy_bots</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">enemy_bots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A list of enemy Bots.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        enemy_bots : list of Bot objects</span>
<span class="sd">            all Bots on all enemy teams</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_uni</span><span class="o">.</span><span class="n">enemy_bots</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">me</span><span class="o">.</span><span class="n">team_index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Pelita</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=&repo=&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="info.html">Project Information</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Writing a Player</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#player-basics">Player Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#doing-more">Doing More</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-maze-coordinate-system">The Maze Coordinate System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#distances-in-the-maze">Distances in the Maze</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recovery-strategies-in-case-of-death-or-timeout">Recovery Strategies in Case of Death or Timeout</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interacting-with-the-maze">Interacting with the Maze</a></li>
<li class="toctree-l2"><a class="reference internal" href="#noisy-enemy-positions">Noisy Enemy Positions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation-details-of-convenience-properties">Implementation Details of Convenience Properties</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="running_player.html">Running Players</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-api.html">User API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API reference</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011–2015, Valentin Haenel, Rike-Benjamin Schuppner et. al..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="_sources/writing_player.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>